FROM php:7.4-cli
EXPOSE 9091/tcp
RUN docker-php-ext-install sockets
RUN mkdir -p /usr/src/app
RUN echo PD9waHAKCmZ1bmN0aW9uIHNvY2tldF9jaGVjaygkbmFtZSwkdmFsdWUpewoJaWYoJHZhbHVlID09PSBmYWxzZSl7CgkJcHJpbnRmKCIlcyBmYWlsZWQ6ICVzXG4iLCRuYW1lLHNvY2tldF9zdHJlcnJvcihzb2NrZXRfbGFzdF9lcnJvcigpKSk7CgkJZXhpdCgyKTsKCX0KfQoKc2V0X3RpbWVfbGltaXQoMCk7CnNvY2tldF9jaGVjaygnc29ja2V0X2NyZWF0ZScsJHNvY2sgPSBzb2NrZXRfY3JlYXRlKEFGX0lORVQsIFNPQ0tfU1RSRUFNLCBTT0xfVENQKSk7CnNvY2tldF9jaGVjaygnc29ja2V0X2JpbmQnLHNvY2tldF9iaW5kKCRzb2NrLCAnMC4wLjAuMCcsIDkwOTEpKTsKc29ja2V0X2NoZWNrKCdzb2NrZXRfbGlzdGVuJyxzb2NrZXRfbGlzdGVuKCRzb2NrLCA1KSk7CmVjaG8gIkxpc3RlbmluZyBmb3IgY29ubmVjdGlvbnMgb24gOTA5MSFcbiI7CndoaWxlKHRydWUpewoJc29ja2V0X2NoZWNrKCdzb2NrZXRfYWNjZXB0JywkbXNnc29jayA9IHNvY2tldF9hY2NlcHQoJHNvY2spKTsKCSRtc2cgPSAiXG5UaGlzIGlzIGEgdGVzdC4iOwoJc29ja2V0X3dyaXRlKCRtc2dzb2NrLCAkbXNnLCBzdHJsZW4oJG1zZykpOwoJc29ja2V0X2Nsb3NlKCRtc2dzb2NrKTsKfQpzb2NrZXRfY2xvc2UoJHNvY2spOw== | base64 -d > /usr/src/app/main.php
WORKDIR /usr/src/app
CMD [ "php", "./main.php" ]